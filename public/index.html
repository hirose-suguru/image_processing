<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ç”»åƒã®ç‰¹å®šã®è‰²ã‚’åˆ¥ã®è‰²ã«ç°¡å˜ã«ç½®æ›ã§ãã‚‹ç„¡æ–™Webãƒ„ãƒ¼ãƒ«ã€‚PNG/JPEGå¯¾å¿œã€ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§å®Œçµã€‚">

    <!-- OGP (Open Graph Protocol) -->
    <meta property="og:title" content="ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰æ¤œç´¢ãƒ»ç½®æ›ãƒ„ãƒ¼ãƒ«">
    <meta property="og:description" content="ç”»åƒã®ç‰¹å®šã®è‰²ã‚’åˆ¥ã®è‰²ã«ç°¡å˜ã«ç½®æ›ã§ãã‚‹ç„¡æ–™Webãƒ„ãƒ¼ãƒ«">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="ja_JP">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰æ¤œç´¢ãƒ»ç½®æ›ãƒ„ãƒ¼ãƒ«">
    <meta name="twitter:description" content="ç”»åƒã®ç‰¹å®šã®è‰²ã‚’åˆ¥ã®è‰²ã«ç°¡å˜ã«ç½®æ›ã§ãã‚‹ç„¡æ–™Webãƒ„ãƒ¼ãƒ«">

    <title>ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰æ¤œç´¢ãƒ»ç½®æ›ãƒ„ãƒ¼ãƒ«</title>

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="output.css">
</head>
<body class="bg-white min-h-screen">
    <div class="w-full max-w-7xl mx-auto p-4 pt-4">
        <!-- Main 2-Column Layout -->
        <div class="flex gap-8 flex-col lg:flex-row items-start">

            <!-- Left Column: Header + Image Preview Area -->
            <div class="flex-1 w-full space-y-4">
                <!-- Header -->
                <header class="border-b border-slate-300 flex items-center gap-4 flex-wrap justify-between" style="padding-bottom: 10px;">
                    <div class="flex items-center gap-4 flex-wrap">
                        <h1 class="font-semibold text-slate-900" style="font-family: 'M PLUS Rounded 1c', sans-serif; font-size: 1.60rem;"
                            >ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰æ¤œç´¢ãƒ»ç½®æ›ãƒ„ãƒ¼ãƒ«</h1>
                        <!-- File Input Button -->
                        <input type="file" id="fileInput" accept="image/png, image/jpeg, image/jpg" class="hidden">
                        <button onclick="document.getElementById('fileInput').click()"
                                class="px-6 py-2.5 text-white rounded-lg font-medium transition-all duration-300 ease-out hover:brightness-110 hover:shadow-lg hover:-translate-y-0.5 active:scale-[0.98] focus:outline-none focus:ring-2 focus:ring-offset-2"
                                style="background-color: rgba(195, 135, 1, 0.5); font-size: 1rem; text-shadow: 0 1px 1.5px rgba(0, 0, 0, 0.15);">
                            ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ
                        </button>
                    </div>
                    <p class="text-slate-600 text-sm bg-slate-50 px-3 py-2 rounded border border-slate-200 max-w-xs" id="infoMessage"></p>
                </header>

                <!-- Canvas Section -->
                <div class="border-2 border-dashed border-slate-200 rounded-xl min-h-[500px] flex items-center justify-center bg-slate-50 overflow-auto p-8">
                    <span class="text-slate-400 text-lg" id="placeholderText">ç”»åƒã‚’é¸æŠã—ã¦ãã ã•ã„</span>
                    <canvas id="canvas" class="max-w-full max-h-[600px] cursor-crosshair hidden"></canvas>
                </div>

                <!-- Footer Info -->
                <div class="flex items-end gap-4" style="font-family: 'M PLUS Rounded 1c', sans-serif; font-size: 1.375rem; margin-top: -4px;">
                    <div class="text-left">
                        <p class="text-slate-700">æ”¹å–„ãƒ»ä¿®æ­£ã®è¦æœ›ãŒã‚ã‚Œã° DM <span style="font-size: 1.5rem;">ğŸ“©</span> ã—ã¦ãã ã•ã„ï¼</p>
                        <p>
                            <a href="https://x.com/hirose_suguru" target="_blank" rel="noopener noreferrer" style="color: #2563eb; text-decoration: underline;">åºƒç€¬ãƒ»ã‚¢ãƒ¼ã‚µãƒ¼ãƒ»å‚‘ã®X</a>
                        </p>
                    </div>
                    <img src="icon_1.jpg" alt="åºƒç€¬ãƒ»ã‚¢ãƒ¼ã‚µãƒ¼ãƒ»å‚‘" style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover;">
                </div>
            </div>

            <!-- Right Column: Control Panel -->
            <div class="w-full lg:w-96 space-y-6">
                <!-- Color Info Section -->
                <div class="bg-white rounded-xl border-2 border-slate-400 p-6 space-y-6">
                    <h2 class="text-lg font-semibold text-slate-900">ã‚«ãƒ©ãƒ¼è¨­å®š</h2>

                    <!-- Selected Color (A) -->
                    <div class="space-y-2">
                        <label class="text-sm font-medium text-slate-700">ã‚¯ãƒªãƒƒã‚¯ã—ãŸè‰²</label>
                        <div class="flex items-center gap-3">
                            <div class="w-16 h-16 rounded-lg border-2 border-slate-300 flex-shrink-0" id="selectedColorSample" style="background: #ffffff;"></div>
                            <div class="space-y-1 flex-1">
                                <div class="font-mono text-sm bg-slate-50 px-3 py-2 rounded border border-slate-200" id="selectedColorHex">#000000</div>
                                <div class="font-mono text-sm text-slate-500 px-3" id="selectedColorRgb">RGB(0, 0, 0)</div>
                            </div>
                        </div>
                    </div>

                    <div class="border-b border-slate-300" style="margin-left: 10px; margin-right: 10px;"></div>

                    <!-- New Color (B) -->
                    <div class="space-y-2">
                        <label class="text-sm font-medium text-slate-700">æ–°ã—ã„è‰²</label>
                        <div class="flex items-center gap-3">
                            <input type="color" id="colorPicker" value="#FF0000"
                                   class="w-16 h-16 rounded-lg border-2 border-slate-300 cursor-pointer">
                            <div class="space-y-1 flex-1">
                                <input type="text" id="newColorInput" placeholder="#FF0000" value="#FF0000" maxlength="7"
                                       class="w-full font-mono text-sm px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:border-transparent transition-all duration-300">
                                <div class="font-mono text-sm text-slate-500 px-3" id="newColorRgb">RGB(255, 0, 0)</div>
                            </div>
                        </div>
                    </div>

                    <!-- Alpha (Transparency) Setting -->
                    <div class="space-y-2">
                        <label class="text-sm font-medium text-slate-700">é€éæ€§</label>
                        <input type="range" id="alphaSlider" min="0" max="255" value="255"
                               class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer"
                               style="accent-color: rgba(0,135, 196, 0.7);">
                        <div class="font-mono text-xs text-slate-600 text-center bg-slate-50 px-3 py-2 rounded" id="alphaValue">255 (ä¸é€æ˜)</div>
                        <div class="w-full h-10 rounded-lg border-slate-300 checkerboard-bg" id="newColorSample" style="background: #FF0000; border-width: 3px;"></div>
                    </div>
                </div>

                <!-- Button Section -->
                <div class="flex gap-2">
                    <button id="replaceBtn" onclick="replaceColor()" disabled
                            class="flex-1 px-3 py-2.5 text-white rounded-lg font-medium transition-all duration-300 ease-out hover:opacity-90 hover:shadow-lg active:scale-[0.98] focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:shadow-none disabled:hover:scale-100"
                            style="background-color: rgba(0, 135, 196, 0.7); font-size: 1rem; text-shadow: 0 1px 1.5px rgba(0, 0, 0, 0.15);">
                        ã‚«ãƒ©ãƒ¼ç½®æ›
                    </button>
                    <button id="copyBtn" onclick="copyToClipboard()" disabled
                            class="flex-1 px-3 py-2.5 border border-slate-400 text-slate-700 rounded-lg font-medium transition-all duration-300 hover:bg-slate-50 hover:border-slate-500 active:scale-[0.98] focus:outline-none focus:ring-2 focus:ring-slate-400 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-white disabled:hover:scale-100"
                            style="font-size: 1rem;">
                        ã‚³ãƒ”ãƒ¼
                    </button>
                    <button id="downloadBtn" onclick="downloadImage()" disabled
                            class="flex-1 px-3 py-2.5 border border-slate-400 text-slate-700 rounded-lg font-medium transition-all duration-300 hover:bg-slate-50 hover:border-slate-500 active:scale-[0.98] focus:outline-none focus:ring-2 focus:ring-slate-400 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-white disabled:hover:scale-100"
                            style="font-size: 1rem;">
                        ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                    </button>
                </div>

            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const fileInput = document.getElementById('fileInput');
        const placeholderText = document.getElementById('placeholderText');
        const selectedColorSample = document.getElementById('selectedColorSample');
        const selectedColorHex = document.getElementById('selectedColorHex');
        const selectedColorRgb = document.getElementById('selectedColorRgb');
        const newColorInput = document.getElementById('newColorInput');
        const colorPicker = document.getElementById('colorPicker');
        const newColorSample = document.getElementById('newColorSample');
        const newColorRgb = document.getElementById('newColorRgb');
        const replaceBtn = document.getElementById('replaceBtn');
        const copyBtn = document.getElementById('copyBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const infoMessage = document.getElementById('infoMessage');
        const alphaSlider = document.getElementById('alphaSlider');
        const alphaValue = document.getElementById('alphaValue');

        let selectedColor = null;
        let currentImage = null;

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ›´æ–°é–¢æ•°ï¼ˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãï¼‰
        function updateMessage(text) {
            infoMessage.classList.remove('animate-slide-up');
            infoMessage.textContent = text;
            // ãƒˆãƒªã‚¬ãƒ¼ã®ãŸã‚å°‘ã—å¾…ã¤
            setTimeout(() => {
                infoMessage.classList.add('animate-slide-up');
            }, 10);
        }

        // ç”»åƒèª­ã¿è¾¼ã¿
        fileInput.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (!file) return;

            // ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ãƒã‚§ãƒƒã‚¯
            if (!file.type.match('image/(png|jpeg|jpg)')) {
                alert('PNG ã¾ãŸã¯ JPEG/JPG å½¢å¼ã®ç”»åƒã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    // Canvas ã®ã‚µã‚¤ã‚ºã‚’ç”»åƒã«åˆã‚ã›ã‚‹
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.drawImage(img, 0, 0);

                    // UIæ›´æ–°ï¼ˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãï¼‰
                    placeholderText.style.display = 'none';
                    canvas.style.display = 'block';
                    canvas.classList.add('animate-fade-in');
                    copyBtn.disabled = false;
                    downloadBtn.disabled = false;
                    updateMessage('ç”»åƒä¸Šã®ä»»æ„ã®å ´æ‰€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€ç½®æ›ã—ãŸã„è‰²ã‚’é¸æŠã—ã¦ãã ã•ã„');

                    currentImage = img;
                };
                img.onerror = function() {
                    alert('ç”»åƒã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
                };
                img.src = e.target.result;
            };
            reader.onerror = function() {
                alert('ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
            };
            reader.readAsDataURL(file);
        });

        // Canvas ã‚¯ãƒªãƒƒã‚¯ã§ã‚«ãƒ©ãƒ¼å–å¾—
        canvas.addEventListener('click', function(event) {
            const rect = canvas.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;

            // Canvasåº§æ¨™ã‚’å…ƒç”»åƒã®åº§æ¨™ã«å¤‰æ›
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            const pixelX = Math.floor(x * scaleX);
            const pixelY = Math.floor(y * scaleY);

            // ãƒ”ã‚¯ã‚»ãƒ«è‰²ã‚’å–å¾—
            const imageData = ctx.getImageData(pixelX, pixelY, 1, 1);
            const data = imageData.data;
            const r = data[0];
            const g = data[1];
            const b = data[2];
            const a = data[3];

            // é¸æŠã—ãŸè‰²ã‚’ä¿å­˜
            selectedColor = { r, g, b, a };

            // UIæ›´æ–°
            const hexColor = rgbToHex(r, g, b);
            selectedColorSample.style.background = hexColor;
            selectedColorHex.textContent = hexColor;
            selectedColorRgb.textContent = `RGB(${r}, ${g}, ${b})`;

            // ç½®æ›ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
            replaceBtn.disabled = false;
        });

        // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–°é–¢æ•°ï¼ˆé€æ˜åº¦ã‚’åæ˜ ï¼‰
        function updateColorPreview() {
            const hex = newColorInput.value.trim();
            if (/^#[0-9A-Fa-f]{6}$/.test(hex)) {
                const rgb = hexToRgb(hex);
                const alpha = parseInt(alphaSlider.value) / 255;
                newColorSample.style.background = `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, ${alpha})`;
                newColorRgb.textContent = `RGB(${rgb.r}, ${rgb.g}, ${rgb.b})`;
            }
        }

        // ã‚«ãƒ©ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼ã¨å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®åŒæœŸ
        colorPicker.addEventListener('input', function() {
            newColorInput.value = colorPicker.value.toUpperCase();
            updateColorPreview();
        });

        newColorInput.addEventListener('input', function() {
            const hex = newColorInput.value.trim();
            if (/^#[0-9A-Fa-f]{6}$/.test(hex)) {
                colorPicker.value = hex;
                updateColorPreview();
            }
        });

        // Alphaã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®æ›´æ–°
        alphaSlider.addEventListener('input', function() {
            const alpha = parseInt(alphaSlider.value);
            const percentage = Math.round((alpha / 255) * 100);
            if (alpha === 255) {
                alphaValue.textContent = '255 (ä¸é€æ˜)';
            } else if (alpha === 0) {
                alphaValue.textContent = '0 (å®Œå…¨é€æ˜)';
            } else {
                alphaValue.textContent = `${alpha} (${percentage}%)`;
            }
            updateColorPreview();
        });

        // RGB â†’ Hex å¤‰æ›
        function rgbToHex(r, g, b) {
            return '#' + [r, g, b]
                .map(x => x.toString(16).padStart(2, '0').toUpperCase())
                .join('');
        }

        // Hex â†’ RGB å¤‰æ›
        function hexToRgb(hex) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return { r, g, b };
        }

        // é¡ä¼¼è‰²ãƒã‚§ãƒƒã‚¯é–¢æ•° (RGBå€¤ãŒÂ±5ä»¥å†…)
        function isSimilarColor(r, g, b, targetColor, tolerance = 5) {
            return Math.abs(r - targetColor.r) <= tolerance &&
                   Math.abs(g - targetColor.g) <= tolerance &&
                   Math.abs(b - targetColor.b) <= tolerance;
        }

        // ã‚«ãƒ©ãƒ¼ç½®æ›
        function replaceColor() {
            if (!selectedColor) {
                alert('å…ˆã«ç”»åƒä¸Šã®è‰²ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            const newColorHex = newColorInput.value.trim();
            if (!/^#[0-9A-Fa-f]{6}$/.test(newColorHex)) {
                alert('æ­£ã—ã„16é€²æ•°ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ (#RRGGBB) ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            const newColor = hexToRgb(newColorHex);
            const newAlpha = parseInt(alphaSlider.value);

            // å‡¦ç†ä¸­ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            updateMessage('å‡¦ç†ä¸­...');
            replaceBtn.disabled = true;

            // éåŒæœŸå‡¦ç†ã§ UI ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ãªã„
            setTimeout(() => {
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imageData.data;
                let replacedCount = 0;

                // å…¨ãƒ”ã‚¯ã‚»ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯
                for (let i = 0; i < data.length; i += 4) {
                    const r = data[i];
                    const g = data[i + 1];
                    const b = data[i + 2];

                    // é¡ä¼¼è‰²ãƒã‚§ãƒƒã‚¯ (RGBå€¤ãŒÂ±5ä»¥å†…)
                    if (isSimilarColor(r, g, b, selectedColor, 5)) {
                        // æ–°ã—ã„è‰²ã«ç½®æ› + Alphaå€¤ã‚‚è¨­å®š
                        data[i] = newColor.r;
                        data[i + 1] = newColor.g;
                        data[i + 2] = newColor.b;
                        data[i + 3] = newAlpha; // Alphaå€¤ã‚’è¨­å®š
                        replacedCount++;
                    }
                }

                // Canvas ã«åæ˜ 
                ctx.putImageData(imageData, 0, 0);

                // å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                updateMessage(`ç½®æ›å®Œäº†! ${replacedCount.toLocaleString()} ãƒ”ã‚¯ã‚»ãƒ«ã‚’ç½®æ›ã—ã¾ã—ãŸã€‚`);
                replaceBtn.disabled = false;

                if (replacedCount === 0) {
                    alert('æŒ‡å®šã—ãŸè‰²ã¨é¡ä¼¼ã™ã‚‹ãƒ”ã‚¯ã‚»ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚');
                }
            }, 100);
        }

        // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
        async function copyToClipboard() {
            try {
                // Canvasã‚’Blobã«å¤‰æ›
                canvas.toBlob(async (blob) => {
                    if (!blob) {
                        alert('ç”»åƒã®ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
                        return;
                    }

                    try {
                        // Clipboard APIã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ”ãƒ¼
                        await navigator.clipboard.write([
                            new ClipboardItem({
                                'image/png': blob
                            })
                        ]);
                        updateMessage('ç”»åƒã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ!');
                    } catch (err) {
                        console.error('ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã¸ã®ã‚³ãƒ”ãƒ¼ã«å¤±æ•—:', err);
                        alert('ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã¸ã®ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ãŒã“ã®æ©Ÿèƒ½ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚');
                    }
                }, 'image/png');
            } catch (err) {
                console.error('ã‚¨ãƒ©ãƒ¼:', err);
                alert('ç”»åƒã®ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
            }
        }

        // ç”»åƒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        function downloadImage() {
            canvas.toBlob(function(blob) {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'replaced_image.png';
                a.click();
                URL.revokeObjectURL(url);
                updateMessage('ç”»åƒã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ!');
            }, 'image/png');
        }
    </script>
</body>
</html>
